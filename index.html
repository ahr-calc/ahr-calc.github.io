<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
  <div id="calculator">
    <script>
let aInputs = [], bInput, cInput, extraInput, resultDiv;

const digits = {
    '0': [[1,1,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]],
    '1': [[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,1,0]],
    '2': [[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],
    '3': [[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],
    '4': [[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],
    '5': [[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],
    '6': [[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],
    '7': [[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],
    '8': [[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],
    '9': [[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]
};

// ç”Ÿå‘½æ¸¸æˆå‚æ•°
let cellSize = 8;
let cols, rows;
let grid;
let nextGrid;
let isPaused = false;

function setup() {
  const canvas = createCanvas(800, 600);
  canvas.position(20, 350);
  background(240);
  textSize(14);
  
  // åˆå§‹åŒ–ç”Ÿå‘½æ¸¸æˆ
  cols = width / cellSize;
  rows = height / cellSize;
  grid = create2DArray(cols, rows);
  nextGrid = create2DArray(cols, rows);
  
  // åˆ›å»ºè®¡ç®—å™¨UI
  let y = 20;
  createDiv('<h1>=== ğŸ¨ è‰ºæœ¯å®¶æ—¶è–ªè®¡ç®—å™¨ Version0.1a ===</h1>').position(20, y);
  y += 50;
  createDiv('<h6>AHR-Calc=Artist Hourly Rate Calculator ( ZIJIEå‡ºå“ï¼Œ2025å¹´æ˜¥ )</h6>').position(300, y);
  y += 15;
  createDiv('<div style="max-width:600px"><h6>è¯´æ˜ï¼šæœ€è¿‘åˆšå¥½ç¢°åˆ°ç±»ä¼¼é—®é¢˜ï¼Œäºæ˜¯å‚è€ƒäº†ä¸€ä»½è‰ºæœ¯å®¶å·¥ä¼šæ‰‹å†Œï¼Œå†™äº†ä¸ªè‰ºæœ¯å®¶æ—¶è–ªè®¡ç®—å™¨ã€‚å½“ç„¶ä¸­å›½çš„è‰ºæœ¯å®¶è¦é¢å¯¹ä¸å¤ªä¸€æ ·çš„æƒ…å†µï¼Œè¿˜è¦æ ¹æ®å…·ä½“ä¿®æ”¹ï¼›åŒæ—¶å¾€é‡ŒåŠ äº†ä¸ªç”Ÿå‘½æ¸¸æˆï¼Œè¾“å…¥çš„æ•°å€¼ä¼šä½¿å…¶å‡ºç°åˆå§‹ç‚¹é˜µï¼Œç„¶åæŒç»­æ¼”åŒ–ã€‚ï¼ˆæ•²ç©ºæ ¼=æš‚åœï¼Œå¯é¼ æ ‡å³é”®å¦å­˜æ¸¸æˆçš„æœ€ç»ˆç”Ÿæˆå›¾æ¡ˆã€‚ï¼‰</h6>').position(200, y);
  y += 50;

  createDiv(`<div style="max-width:600px"><h3>è®¡ç®—åŸç†ï¼š</h3><p>æ—¶è–ª = (Aç±»å¹´åº¦æ€»æˆæœ¬ + Bç±»å¹´æ”¶å…¥) Ã· Cç±»å¹´å·¥ä½œæ—¶é—´ Ã— (1 + é¢å¤–è´¹ç‡)ï¼›å…¶ä¸­ï¼š</p><ul><li>Aç±»ï¼šå¹´åº¦è¿è¥æˆæœ¬ï¼ˆ9é¡¹æ”¯å‡ºæ€»å’Œï¼‰</li><li>Bç±»ï¼šç¬¦åˆå¸‚åœºæ ‡å‡†çš„å¹´æ”¶å…¥</li><li>Cç±»ï¼šå¹´å·¥ä½œæ—¶é—´ï¼ˆé»˜è®¤1610å°æ—¶ï¼‰</li><li>é¢å¤–è´¹ç‡ï¼š10%-15%çš„åˆ©æ¶¦ç©ºé—´</li></ul></div>`).position(10, y);
  y += 190;

  // Aç±»è¾“å…¥
  createDiv('<h3>ğŸ› ï¸ Aç±»ï¼šå¹´åº¦è¿è¥æˆæœ¬</h3>').position(20, y).style('color', '#FF5733');
  y += 50;
  const aLabels = [
    'å·¥ä½œå®¤ç§Ÿé‡‘', 'æ¶ˆè€—å“ï¼ˆæ–‡å…·/ç”µå­ï¼‰', 'åˆ›ä½œç”¨æ', 
    'è®¾å¤‡ç»´æŠ¤', 'äººåŠ›å¤–åŒ…', 'è¿è¾“ç‰©æµ',
    'æ¨å¹¿è¥é”€', 'åŒ»ç–—ä¿é™©', 'ç¨è´¹ä¿é™©'
  ];
  aLabels.forEach((label, i) => {
    createDiv(`${label}: `).position(30, y + i*30);
    let input = createInput('0').position(200, y + i*30 - 5).size(150);
    aInputs.push(input);
  });
  y += aLabels.length * 30 + 0;

  // å…¶ä»–è¾“å…¥
  createDiv('<h3>ğŸ’° Bç±»ï¼šç›®æ ‡å¹´æ”¶å…¥</h3>').position(20, y).style('color', '#FF5733');
  y += 50;
  createDiv('å¸‚åœºæ ‡å‡†å¹´æ”¶å…¥: ').position(30, y);
  bInput = createInput('0').position(200, y - 5).size(150);
  y += 10;

  createDiv('<h3>â±ï¸ Cç±»ï¼šå·¥ä½œæ—¶é—´</h3>').position(20, y).style('color', '#FF5733');
  y += 50;
  createDiv('å¹´å·¥ä½œå°æ—¶æ•°: ').position(30, y);
  cInput = createInput('1610').position(200, y - 5).size(150);
  y += 10;

  createDiv('<h3>âœ¨ é¢å¤–è´¹ç‡</h3>').position(20, y).style('color', '#FF5733');
  y += 50;
  createDiv('è´¹ç‡ç™¾åˆ†æ¯” (10-15%): ').position(30, y);
  extraInput = createInput('12.5').position(200, y - 5).size(150);
  createDiv('%').position(360, y);
  y += 50;

  // è®¡ç®—æŒ‰é’®
  createButton('ğŸ“Š è®¡ç®—æ—¶è–ª').position(20, y).mousePressed(calculate).size(120, 30);
  y += 50;

  // ç»“æœåŒºåŸŸ
  resultDiv = createDiv('').position(20, y).size(600, 200);

  // æ¬¢è¿æèµ 
<img src="https://raw.githubusercontent.com/ahr-calc/ahr-calc.github.io/master/for-donation.png"
         alt="å¦‚æœç”¨èµ·æ¥è§‰å¾—æ–¹ä¾¿ï¼Œæ¬¢è¿æ‰“èµ"
         crossorigin="zijie">

  
  // ç»‘å®šè¾“å…¥äº‹ä»¶
  const inputs = [bInput, cInput, extraInput, ...aInputs];
  inputs.forEach(input => input.input(() => {
    initializeGrid();
  }));
  
  initializeGrid();
  frameRate(10);
}

function draw() {
  background(255);
  
  if (!isPaused) {
    computeNextGeneration();
    swapGrids();
  }
  
  drawGrid();
}

// ç”Ÿå‘½æ¸¸æˆå‡½æ•°
function create2DArray(cols, rows) {
  return Array(cols).fill().map(() => Array(rows).fill(0));
}

function initializeGrid() {
  grid = create2DArray(cols, rows);
  const allValues = [bInput.value(), cInput.value(), extraInput.value(), ...aInputs.map(i => i.value())];
  const allDigits = allValues.join('').split('').filter(c => c in digits);
  
  allDigits.forEach(digit => {
    const pattern = digits[digit];
    const w = pattern[0].length;
    const h = pattern.length;
    
    const x = floor(random(cols - w));
    const y = floor(random(rows - h));
    
    for (let i = 0; i < h; i++) {
      for (let j = 0; j < w; j++) {
        const col = x + j;
        const row = y + i;
        if (col < cols && row < rows) {
          grid[col][row] = pattern[i][j];
        }
      }
    }
  });
}

function drawGrid() {
  for (let i = 0; i < cols; i++) {
    for (let j = 0; j < rows; j++) {
      fill(grid[i][j] ? 200 : 255);
      stroke(200);
      rect(i * cellSize, j * cellSize, cellSize, cellSize);
    }
  }
}

function computeNextGeneration() {
  for (let i = 0; i < cols; i++) {
    for (let j = 0; j < rows; j++) {
      const neighbors = countNeighbors(i, j);
      nextGrid[i][j] = grid[i][j] ? (neighbors === 2 || neighbors === 3) : (neighbors === 3);
    }
  }
}

function countNeighbors(x, y) {
  let sum = 0;
  for (let i = -1; i <= 1; i++) {
    for (let j = -1; j <= 1; j++) {
      const col = (x + i + cols) % cols;
      const row = (y + j + rows) % rows;
      sum += grid[col][row];
    }
  }
  return sum - grid[x][y];
}

function swapGrids() {
  [grid, nextGrid] = [nextGrid, grid];
}

function keyPressed() {
  if (key === ' ') isPaused = !isPaused;
}

// åŸè®¡ç®—å™¨é€»è¾‘
function calculate() {
  const validate = (v, d = 0) => isNaN(parseFloat(v)) ? d : parseFloat(v);
  const aTotal = aInputs.reduce((s, i) => s + validate(i.value()), 0);
  
  const b = validate(bInput.value());
  const c = validate(cInput.value(), 1610);
  let extra = validate(extraInput.value(), 12.5);
  extra = constrain(extra, 10, 15) / 100;

  const baseRate = (aTotal + b) / c;
  const finalRate = baseRate * (1 + extra);

  resultDiv.html(`<div style="background:#bbffbb; padding:5px; border-radius:8px">
    <h3>ğŸ“ è®¡ç®—ç»“æœ</h3><p>Aç±»æ€»æˆæœ¬: ${aTotal.toFixed(2)}</p>
    <p>Bç±»å¹´æ”¶å…¥: ${b.toFixed(2)}</p><p>å·¥ä½œæ—¶é—´: ${c} å°æ—¶</p>
    <p>è´¹ç‡åŠ æˆ: ${(extra*100).toFixed(1)}%</p><hr>
    <h4>åŸºç¡€æ—¶è–ª: ${baseRate.toFixed(2)}</h4>
    <h2>æœ€ç»ˆå»ºè®®æ—¶è–ª: ğŸ’° ${finalRate.toFixed(2)}/å°æ—¶</h2></div>`);
  // æ–°å¢ï¼šå°†è®¡ç®—ç»“æœå†™å…¥ç”Ÿå‘½æ¸¸æˆç½‘æ ¼
  const rateString = finalRate.toFixed(2).replace('.', ''); // ç¤ºä¾‹ï¼š50.25 â†’ "5025"
  rateString.split('').forEach(char => {
    if (digits[char]) {
      const pattern = digits[char];
      const w = pattern[0].length;
      const h = pattern.length;
      
      // éšæœºä½ç½®ç”Ÿæˆï¼ˆé¿å¼€è¾¹ç¼˜ï¼‰
      const x = floor(random(10, cols - w - 10));
      const y = floor(random(10, rows - h - 10));
      
      // å†™å…¥ç½‘æ ¼ï¼ˆä½¿ç”¨é€»è¾‘æˆ–ä¿ç•™å·²æœ‰ç»†èƒï¼‰
      for (let i = 0; i < h; i++) {
        for (let j = 0; j < w; j++) {
          const col = x + j;
          const row = y + i;
          if (col < cols && row < rows) {
            grid[col][row] = grid[col][row] || pattern[i][j]; // ä¿ç•™åŸæœ‰æ´»ç»†èƒ
          }
        }
      }
    }
  });
}
    </script>
  </div>
</body>
</html>
